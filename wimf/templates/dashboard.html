{% extends "parent-template.html" %}
{% from "bootstrap5/form.html" import render_form %}

{% block title %}
    Dashboard
{% endblock %}

{% block main %}
    <h1 class="center">What's in my fridge</h1>
    <hr>
    {% if current_items|length > 0 %}
    <table class="center">
      <thead>
        <tr>
            <th><a href="/?sort=name&direction=asc">Name</a></th>
            <th><a href="/?sort=quantity&direction=asc">Qty</a></th>
            <th><a href="/?sort=date_added&direction=asc">Added</a></th>
            <th><a href="/?sort=expiry_date&direction=asc">Expires</a></th>
            <th>Edit</th>
            <th>Delete</th>
            <th>Archive</th>
        </tr>
      </thead>
      <tbody>
        {% for i in current_items %}
            {% set days_to_expiry = i.days_to_expiry() %}
            <tr class="{{ '' if days_to_expiry is none else 'expired' if days_to_expiry <= 0 else 'expiring-soon' if days_to_expiry <= 3 else '' }}">
                <td>{{ i.name }}</td>
                <td>{{ i.quantity }}</td>
                <td>{{ i.date_added.isoformat() }}</td>
                <td>{{ i.expiry_date.isoformat() if i.expiry_date else 'N/A' }}</td>
                <td>
                    <form action="{{ url_for('views.edit_item', item_id=i.item_id) }}" method="get" class="edit-item">
                        <input type="submit" value="Edit" />
                    </form>
                </td>
                <td>
                    <form action="{{ url_for('views.delete_item', item_id=i.item_id) }}" method="post" class="delete-item">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                        <input type="submit" value="Delete" />
                    </form>
                </td>
                <td>
                    <form action="{{ url_for('views.archived_item', item_id=i.item_id, archived=1) }}" method="post" class="archive-item">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                        <input type="submit" value="Archived" />
                    </form>
                </td>

            </tr>
            {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p class="center">Nothing in the fridge!</p>
    {% endif %}
    {{ render_form(form) }}
{% endblock %}
